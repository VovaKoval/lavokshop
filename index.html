<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>üöÄ CRM –î—Ä–æ–ø—à–∏–ø—ñ–Ω–≥ Pro LaVok SHOP by Koval</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }

        body {
            overscroll-behavior: contain;
        }

        .modal-overlay {
            animation: fadeIn 0.18s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            animation: slideUp 0.22s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // –Ü–∫–æ–Ω–∫–∏
        const PackageIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16.5 9.4l-9-5.19M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>;
        const ShoppingBagIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>;
        const CheckSquareIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>;
        const MessageSquareIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>;
        const BarChartIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>;
        const SearchIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>;
        const UploadIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>;
        const Edit2Icon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>;
        const Trash2Icon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
        const ShareIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>;
        const XIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const CopyIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>;
        const CheckIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const DownloadIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>;
        const TruckIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>;
        const PlusIcon = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;

        function App() {
            const [activeTab, setActiveTab] = useState('products');

            // –î–∞–Ω—ñ
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [suppliers, setSuppliers] = useState([]);
            const [dailyTasks, setDailyTasks] = useState([]);
            const [weeklyGoals, setWeeklyGoals] = useState([]);
            const [priceMarkup, setPriceMarkup] = useState(50); // % –Ω–∞—Ü–µ–Ω–∫–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º

            // –§—ñ–ª—å—Ç—Ä–∏ / –ø–æ—à—É–∫
            const [searchTerm, setSearchTerm] = useState('');
            const [filterSupplier, setFilterSupplier] = useState('all');
            const [filterAvailable, setFilterAvailable] = useState('all');
            const [filterPublished, setFilterPublished] = useState('all');
            const [filterPriceMin, setFilterPriceMin] = useState('');
            const [filterPriceMax, setFilterPriceMax] = useState('');
            const [filterBrand, setFilterBrand] = useState('');
            const [sortBy, setSortBy] = useState('date'); // date, name, price-asc, price-desc
            const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);

            // –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑ XML / –≤–∏–±—ñ—Ä
            const [xmlImportPreview, setXmlImportPreview] = useState([]); // —Ç–æ–≤–∞—Ä–∏ –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥—É –ø–µ—Ä–µ–¥ —ñ–º–ø–æ—Ä—Ç–æ–º
            const [xmlCategories, setXmlCategories] = useState([]);
            const [selectedXmlCategories, setSelectedXmlCategories] = useState([]);
            const [showXmlImportModal, setShowXmlImportModal] = useState(false);
            const [xmlSupplierName, setXmlSupplierName] = useState(''); // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —ñ–º'—è –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥—É

            // –†–µ–∂–∏–º —ñ–º–ø–æ—Ä—Ç—É: 'all' –∞–±–æ 'onlyNew'
            const [xmlImportMode, setXmlImportMode] = useState('all');

            // –ú–æ–¥–∞–ª–∫–∏
            const [showEditModal, setShowEditModal] = useState(false);
            const [showPostModal, setShowPostModal] = useState(false);
            const [showOrderModal, setShowOrderModal] = useState(false);
            const [showTemplatesModal, setShowTemplatesModal] = useState(false);
            const [showAddProductModal, setShowAddProductModal] = useState(false);

            // –ü–æ—Ç–æ—á–Ω—ñ –æ–±'—î–∫—Ç–∏
            const [editingProduct, setEditingProduct] = useState(null);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [newOrder, setNewOrder] = useState(null);
            const [loading, setLoading] = useState(false);

            // –ù–æ–≤–∏–π —Ç–æ–≤–∞—Ä –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è
            const [manualProduct, setManualProduct] = useState({
                name: '', supplier: '', supplierCode: '', basePrice: '', rrp: '', image: '', vendor: '', category: '', available: true, published: false, customPrice: false
            });

            useEffect(() => {
                loadAllData();
                initializeDailyTasks();
                initializeWeeklyGoals();
            }, []);

            // --- –ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤ –∑–∞–º–æ–≤–ª–µ–Ω—å (new -> sent) –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
            useEffect(() => {
                const interval = setInterval(() => {
                    setOrders(prevOrders => prevOrders.map(o => {
                        if (o.status === 'new') {
                            return {...o, status: 'sent'};
                        }
                        return o;
                    }));
                }, 30000); // 30 —Å–µ–∫—É–Ω–¥

                return () => clearInterval(interval);
            }, []);

            const loadAllData = () => {
                try {
                    const prods = localStorage.getItem('crm-products');
                    const ords = localStorage.getItem('crm-orders');
                    const supps = localStorage.getItem('crm-suppliers');
                    const tasks = localStorage.getItem('daily-tasks');
                    const goals = localStorage.getItem('weekly-goals');
                    const markup = localStorage.getItem('price-markup');

                    if (prods) setProducts(JSON.parse(prods));
                    if (ords) setOrders(JSON.parse(ords));
                    if (supps) setSuppliers(JSON.parse(supps));
                    if (tasks) setDailyTasks(JSON.parse(tasks));
                    if (goals) setWeeklyGoals(JSON.parse(goals));
                    if (markup) setPriceMarkup(parseInt(markup));
                } catch (e) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', e);
                }
            };

            const saveAllData = () => {
                localStorage.setItem('crm-products', JSON.stringify(products));
                localStorage.setItem('crm-orders', JSON.stringify(orders));
                localStorage.setItem('crm-suppliers', JSON.stringify(suppliers));
                localStorage.setItem('daily-tasks', JSON.stringify(dailyTasks));
                localStorage.setItem('weekly-goals', JSON.stringify(weeklyGoals));
                localStorage.setItem('price-markup', priceMarkup.toString());
            };

            useEffect(() => {
                saveAllData();
            }, [products, orders, suppliers, dailyTasks, weeklyGoals, priceMarkup]);

            const initializeDailyTasks = () => {
                const today = new Date().toDateString();
                const saved = localStorage.getItem('daily-tasks-date');

                if (saved !== today) {
                    const defaultTasks = [
                        { id: 1, title: '‚òï –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è', done: false },
                        { id: 2, title: 'üì± –í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ', done: false },
                        { id: 3, title: 'üì¶ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤ CRM', done: false },
                        { id: 4, title: 'üîÑ –û–Ω–æ–≤–∏—Ç–∏ —Ç–æ–≤–∞—Ä–∏ –Ω–∞ OLX', done: false },
                        { id: 5, title: 'üè™ –û–Ω–æ–≤–∏—Ç–∏ Prom.ua', done: false },
                        { id: 6, title: 'üé¨ –ó—Ä–æ–±–∏—Ç–∏ 3-5 Stories', done: false },
                        { id: 7, title: 'üìπ –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ Reels/TikTok', done: false },
                        { id: 8, title: 'üõí –û—Ñ–æ—Ä–º–∏—Ç–∏ –Ω–æ–≤—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è', done: false },
                        { id: 9, title: 'üìû –ó–≤\'—è–∑–∞—Ç–∏—Å—å –∑ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞–º–∏', done: false },
                        { id: 10, title: 'üöö –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –¢–¢–ù –∫–ª—ñ—î–Ω—Ç–∞–º', done: false },
                        { id: 11, title: 'üìä –ü–æ–¥–∏–≤–∏—Ç–∏—Å—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É', done: false },
                        { id: 12, title: 'üìù –ó–∞–ø–ª–∞–Ω—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç', done: false }
                    ];
                    setDailyTasks(defaultTasks);
                    localStorage.setItem('daily-tasks-date', today);
                }
            };

            const initializeWeeklyGoals = () => {
                const saved = localStorage.getItem('weekly-goals');
                if (!saved || JSON.parse(saved).length === 0) {
                    const defaultGoals = [
                        { id: 1, title: 'üìπ –ó—Ä–æ–±–∏—Ç–∏ 7 Reels/TikTok', current: 0, target: 7 },
                        { id: 2, title: 'üìñ –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ 21 Stories', current: 0, target: 21 },
                        { id: 3, title: 'üõí –û—Ç—Ä–∏–º–∞—Ç–∏ 15+ –∑–∞–º–æ–≤–ª–µ–Ω—å', current: 0, target: 15 },
                        { id: 4, title: 'üë• +20 –Ω–æ–≤–∏—Ö –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤', current: 0, target: 20 }
                    ];
                    setWeeklyGoals(defaultGoals);
                }
            };

            const generateMyCode = (supplierName) => {
                const prefix = (supplierName || 'SUP').substring(0, 3).toUpperCase();
                const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
                return `${prefix}-${random}`;
            };

            // –ü–∞—Ä—Å–µ—Ä XML, –ø–æ–≤–µ—Ä—Ç–∞—î {products, categories}
            const parseXML = (xmlText, supplierName, options = {}) => {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');

                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–æ–º–∏–ª–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥—É
                const parseError = xmlDoc.getElementsByTagName('parsererror');
                if (parseError.length > 0) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É XML:', parseError[0].textContent);
                    throw new Error('XML —Ñ–∞–π–ª –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π –∞–±–æ –º–∞—î –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç');
                }

                // –®—É–∫–∞—î–º–æ —Ç–æ–≤–∞—Ä–∏
                let offers = xmlDoc.getElementsByTagName('offer');
                if (offers.length === 0) offers = xmlDoc.getElementsByTagName('item');
                if (offers.length === 0) offers = xmlDoc.getElementsByTagName('product');

                if (offers.length === 0) {
                    throw new Error('–í XML —Ñ–∞–π–ª—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä—ñ–≤ (—Ç–µ–≥ <offer>/<item>/<product>)');
                }

                const newProducts = [];
                const categoriesSet = new Set();

                const maxProducts = options.maxProducts || 500;
                const minPrice = options.minPrice || 0;
                const maxPrice = options.maxPrice || 999999;

                for (let i = 0; i < offers.length && newProducts.length < maxProducts; i++) {
                    const offer = offers[i];
                    try {
                        const supplierCode = offer.getAttribute('id') || `ID-${i}`;
                        const name = offer.getElementsByTagName('name')[0]?.textContent || offer.getElementsByTagName('title')[0]?.textContent || '';

                        // –¶—ñ–Ω–∞
                        let price = 0;
                        const priceElement = offer.getElementsByTagName('price')[0] || offer.getElementsByTagName('cost')[0];
                        if (priceElement) {
                            const priceText = priceElement.textContent || '0';
                            price = parseFloat(priceText.replace(/[^\d.]/g, '')) || 0;
                        }

                        // –°–ø—Ä–æ–±–∞ –∑–Ω–∞–π—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
                        let category = '';
                        const c1 = offer.getElementsByTagName('categoryId')[0]?.textContent;
                        const c2 = offer.getElementsByTagName('category')[0]?.textContent;
                        const c3 = offer.getElementsByTagName('typePrefix')[0]?.textContent;
                        const c4 = offer.getElementsByTagName('group')[0]?.textContent;
                        if (c2) category = c2;
                        else if (c1) category = c1;
                        else if (c3) category = c3;
                        else if (c4) category = c4;
                        else {
                            const params = offer.getElementsByTagName('param');
                            for (let pi = 0; pi < params.length; pi++) {
                                const pname = params[pi].getAttribute('name') || params[pi].getAttribute('–Ω–∞–∑–≤–∞') || '';
                                if (/(–∫–∞—Ç–µ–≥–æ—Ä|category|group)/i.test(pname) && params[pi].textContent) {
                                    category = params[pi].textContent;
                                    break;
                                }
                            }
                        }

                        // –ü—Ä–æ–ø—É—Å–∫–∏
                        if (!name || name.trim() === '') continue;
                        if (price === 0 || price < minPrice || price > maxPrice) continue;

                        const availableAttr = offer.getAttribute('available');
                        let available = true;
                        if (availableAttr === 'false' || availableAttr === '0') available = false;

                        const vendor = offer.getElementsByTagName('vendor')[0]?.textContent || '';
                        const pictureElement = offer.getElementsByTagName('picture')[0];
                        const image = pictureElement?.textContent || '';
                        const urlElement = offer.getElementsByTagName('url')[0];
                        const url = offer.getAttribute('url') || urlElement?.textContent || '';

                        const product = {
                            id: `${Date.now()}-${i}`,
                            myCode: generateMyCode(supplierName || 'SUP'),
                            supplierCode: String(supplierCode),
                            name: name.trim().substring(0, 200),
                            supplier: supplierName || '',
                            supplierUrl: String(url).substring(0, 200),
                            basePrice: Math.round(price * 100) / 100,
                            rrp: Math.round(price * (1 + priceMarkup/100) * 100) / 100,
                            available,
                            published: false,
                            vendor: vendor.trim().substring(0, 100),
                            image: image.substring(0, 400),
                            addedDate: new Date().toISOString().split('T')[0],
                            category: category ? category.toString().substring(0, 100) : ''
                        };

                        if (product.category) categoriesSet.add(product.category);
                        newProducts.push(product);

                    } catch (errItem) {
                        console.warn('–ü–æ–º–∏–ª–∫–∞ —Ç–æ–≤–∞—Ä—É –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥—É', errItem);
                    }
                }

                return { products: newProducts, categories: Array.from(categoriesSet) };
            };

            // –û–±—Ä–æ–±–∫–∞ —Ñ–∞–π–ª—É XML: –ø–æ–∫–∞–∑—É—î –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π —ñ –¥–∞—î –≤–∏–±—ñ—Ä
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) {
                    alert('‚ùå –§–∞–π–ª –Ω–µ –æ–±—Ä–∞–Ω–æ');
                    return;
                }
                if (!file.name.toLowerCase().endsWith('.xml')) {
                    alert('‚ùå –ü–æ–º–∏–ª–∫–∞: –æ–±–µ—Ä–∏ XML —Ñ–∞–π–ª');
                    e.target.value = '';
                    return;
                }

                setLoading(true);
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const xmlText = event.target.result;
                        if (!xmlText || xmlText.trim() === '') throw new Error('XML —Ñ–∞–π–ª –ø–æ—Ä–æ–∂–Ω—ñ–π');

                        const supplierName = prompt('–í–≤–µ–¥–∏ –Ω–∞–∑–≤—É –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ (–¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è):', 'ITSellOpt');
                        if (!supplierName) { setLoading(false); e.target.value = ''; return; }
                        setXmlSupplierName(supplierName.trim());

                        const maxProductsInput = prompt('–°–∫—ñ–ª—å–∫–∏ —Ç–æ–≤–∞—Ä—ñ–≤ –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É? (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 500)', '500');
                        const maxProducts = parseInt(maxProductsInput) || 500;

                        const result = parseXML(xmlText, supplierName.trim(), { maxProducts, minPrice: 1 });
                        // result: {products, categories}
                        setXmlImportPreview(result.products);
                        setXmlCategories(result.categories);
                        setSelectedXmlCategories([]); // –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º - –Ω—ñ—á–æ–≥–æ –Ω–µ –æ–±—Ä–∞–Ω–æ
                        setXmlImportMode('all'); // –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —ñ–º–ø–æ—Ä—Ç—É—î–º–æ –≤—Å–µ
                        setShowXmlImportModal(true);
                        setLoading(false);
                        e.target.value = '';
                    } catch (err) {
                        console.error(err);
                        alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —á–∏—Ç–∞–Ω–Ω—ñ XML:\n' + (err.message || err));
                        setLoading(false);
                        e.target.value = '';
                    }
                };
                reader.onerror = (err) => {
                    console.error('–§–∞–π–ª –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ', err);
                    alert('‚ùå –ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—É');
                    setLoading(false);
                    e.target.value = '';
                };
                reader.readAsText(file, 'UTF-8');
            };

            // –Ü–º–ø–æ—Ä—Ç –ø—ñ—Å–ª—è –≤–∏–±–æ—Ä—É –∫–∞—Ç–µ–≥–æ—Ä—ñ–π —Ç–∞ —Ä–µ–∂–∏–º—É —ñ–º–ø–æ—Ä—Ç—É
            const importSelectedXml = () => {
                if (!xmlImportPreview || xmlImportPreview.length === 0) {
                    alert('‚ö†Ô∏è –ù–µ–º–∞—î –≥–æ—Ç–æ–≤–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤ –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É.');
                    return;
                }

                // —Å–ø–æ—á–∞—Ç–∫—É —Ñ—ñ–ª—å—Ç—Ä—É—î–º–æ –ø–æ –≤–∏–±—Ä–∞–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö (—è–∫—â–æ –≤–∏–±—Ä–∞–Ω–æ)
                let candidate = (selectedXmlCategories.length === 0)
                    ? xmlImportPreview.slice()
                    : xmlImportPreview.filter(p => selectedXmlCategories.includes(p.category));

                if (candidate.length === 0) {
                    alert('‚ö†Ô∏è –ù—ñ—á–æ–≥–æ –Ω–µ —ñ–º–ø–æ—Ä—Ç—É—î—Ç—å—Å—è –∑–∞ –æ–±—Ä–∞–Ω–∏–º–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏');
                    return;
                }

                if (xmlImportMode === 'onlyNew') {
                    // –Ü–º–ø–æ—Ä—Ç—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —Ç–æ–≤–∞—Ä–∏, —è–∫—ñ –Ω–µ –º–∞—é—Ç—å –¥—É–±–ª—é –ø–æ supplierCode
                    const existingSupplierCodes = new Set(products.map(p => String(p.supplierCode)));
                    const onlyNew = candidate.filter(p => !existingSupplierCodes.has(String(p.supplierCode)));
                    if (onlyNew.length === 0) {
                        alert('‚ÑπÔ∏è –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–æ–≤–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤ –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É (—É—Å—ñ supplierCode –≤–∂–µ –≤ CRM).');
                        return;
                    }
                    // –£ —Ä–µ–∂–∏–º—ñ onlyNew ‚Äî –Ω–µ –≤–∏–¥–∞–ª—è—î–º–æ —ñ—Å–Ω—É—é—á—ñ —Ç–æ–≤–∞—Ä–∏ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞, –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞—î–º–æ –Ω–æ–≤—ñ
                    const updated = [...products, ...onlyNew];
                    setProducts(updated);
                    // –î–æ–¥–∞—î–º–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
                    if (xmlSupplierName) setSuppliers(prev => Array.from(new Set([xmlSupplierName, ...prev])));
                    setShowXmlImportModal(false);
                    setXmlImportPreview([]);
                    setXmlCategories([]);
                    alert(`‚úÖ –Ü–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ ${onlyNew.length} –Ω–æ–≤–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤ (–±–µ–∑ –¥—É–±–ª—ñ–≤).`);
                    return;
                }

                // –Ø–∫—â–æ —Ä–µ–∂–∏–º 'all' ‚Äî —Å—Ç–∞—Ä–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞: –≤–∏–¥–∞–ª—è—î–º–æ –ø–æ—Ç–æ—á–Ω—ñ —Ç–æ–≤–∞—Ä–∏ —Ü—å–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ —ñ –¥–æ–¥–∞—î–º–æ –≤—Å—ñ
                const supplier = xmlSupplierName || (candidate[0] && candidate[0].supplier) || '';
                const filtered = products.filter(p => p.supplier !== supplier);
                const updated = [...filtered, ...candidate];
                setProducts(updated);
                if (supplier) setSuppliers(prev => Array.from(new Set([supplier, ...prev])));
                setShowXmlImportModal(false);
                setXmlImportPreview([]);
                setXmlCategories([]);
                alert(`‚úÖ –Ü–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ ${candidate.length} —Ç–æ–≤–∞—Ä—ñ–≤ (${xmlImportMode === 'all' ? '–≤—Å—ñ' : '—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω—ñ'}).`);
            };

            const calculateRRP = (basePrice, markup = priceMarkup) => {
                const base = parseFloat(basePrice) || 0;
                const markupPercent = parseFloat(markup) || 0;
                return Math.round(base * (1 + markupPercent / 100) * 100) / 100;
            };

            const applyMarkupToAll = (newMarkup) => {
                const updated = products.map(p => {
                    const base = parseFloat(p.basePrice) || 0;
                    if (!p.customPrice) {
                        return {
                            ...p,
                            rrp: Math.round(base * (1 + newMarkup / 100) * 100) / 100
                        };
                    }
                    return p;
                });
                setProducts(updated);
                setPriceMarkup(newMarkup);
            };

            const updateProduct = (productId, updates) => {
                setProducts(products.map(p => p.id === productId ? { ...p, ...updates } : p));
            };

            const deleteProduct = (productId) => {
                if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä?')) return;
                setProducts(products.filter(p => p.id !== productId));
            };

            const generatePost = (product, platform) => {
                const emojis = { instagram: '‚ú®', facebook: 'üî•', tiktok: 'üéâ' };
                const hashtags = {
                    instagram: '#shop #shopping #ukraine #–æ–Ω–ª–∞–π–Ω—à–æ–ø #–∞–∫—Å–µ—Å—É–∞—Ä–∏ #–≥–∞–¥–∂–µ—Ç–∏ #–∫–∏—ó–≤ #–¥–æ—Å—Ç–∞–≤–∫–∞',
                    facebook: '#—ñ–Ω—Ç–µ—Ä–Ω–µ—Ç–º–∞–≥–∞–∑–∏–Ω #—É–∫—Ä–∞—ó–Ω–∞ #–∞–∫—Å–µ—Å—É–∞—Ä–∏ #–Ω–æ–≤–∞–ø–æ—à—Ç–∞',
                    tiktok: '#—à–æ–ø—ñ–Ω–≥ #ukraine #–≥–∞–¥–∂–µ—Ç–∏ #fyp #viral'
                };

                return `${emojis[platform]} ${product.name}

${product.vendor ? `–ë—Ä–µ–Ω–¥: ${product.vendor}\n` : ''}üí∞ –¶—ñ–Ω–∞: ${product.rrp || product.dropPrice} ‚Ç¥
${product.available ? '‚úÖ –Ñ –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ' : '‚ö†Ô∏è –ü—ñ–¥ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è'}

üì¶ –î–æ—Å—Ç–∞–≤–∫–∞ –ù–æ–≤–æ—é –ü–æ—à—Ç–æ—é
üí≥ –û–ø–ª–∞—Ç–∞: –ù–∞ –≤–∏–±—ñ—Ä

–ó–∞–º–æ–≤–ª—è–π –≤ Direct! üì≤

${hashtags[platform]}`;
            };

            const createOrder = (product) => {
                const finalRRP = parseFloat(product.rrp) || parseFloat(product.basePrice) || 0;
                const finalBase = parseFloat(product.basePrice) || 0;
                setNewOrder({
                    id: Date.now().toString(),
                    productId: product.id,
                    productName: product.name,
                    customerName: '',
                    customerPhone: '',
                    deliveryAddress: '',
                    price: finalRRP,
                    cost: finalBase,
                    ttn: '',
                    status: 'new',
                    createdAt: new Date().toISOString()
                });
                setShowOrderModal(true);
            };

            const saveOrder = () => {
                if (!newOrder.customerName || !newOrder.customerPhone) {
                    alert('‚ö†Ô∏è –ó–∞–ø–æ–≤–Ω–∏ —ñ–º\'—è —Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω');
                    return;
                }
                if (!newOrder.productName) {
                    alert('‚ö†Ô∏è –ó–∞–ø–æ–≤–Ω–∏ –Ω–∞–∑–≤—É —Ç–æ–≤–∞—Ä—É');
                    return;
                }
                setOrders([...orders, newOrder]);
                setShowOrderModal(false);
                setNewOrder(null);
                alert('‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ!');
            };

            const updateOrderStatus = (orderId, status) => {
                setOrders(orders.map(o => o.id === orderId ? {...o, status} : o));
            };

            const updateOrderTTN = (orderId, ttn) => {
                setOrders(orders.map(o => o.id === orderId ? {...o, ttn} : o));
            };

            const exportBackup = () => {
                const backup = {
                    products,
                    orders,
                    suppliers,
                    dailyTasks,
                    weeklyGoals,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };

                const dataStr = JSON.stringify(backup, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                alert('‚úÖ –ë–µ–∫–∞–ø —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!');
            };

            const importBackup = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const backup = JSON.parse(event.target.result);

                        if (confirm(`–í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ –≤—ñ–¥ ${new Date(backup.exportDate).toLocaleDateString('uk-UA')}?\n\n–£–í–ê–ì–ê: –ü–æ—Ç–æ—á–Ω—ñ –¥–∞–Ω—ñ –±—É–¥—É—Ç—å –∑–∞–º—ñ–Ω–µ–Ω—ñ!`)) {
                            setProducts(backup.products || []);
                            setOrders(backup.orders || []);
                            setSuppliers(backup.suppliers || []);
                            setDailyTasks(backup.dailyTasks || []);
                            setWeeklyGoals(backup.weeklyGoals || []);
                            alert('‚úÖ –î–∞–Ω—ñ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ!');
                        }
                    } catch (err) {
                        alert('‚ùå –ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—É!');
                        console.error(err);
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            // –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ç–æ–≤–∞—Ä—ñ–≤ (—Ä–æ–∑—à–∏—Ä–µ–Ω–∞)
            const filteredProducts = products.filter(p => {
                const term = searchTerm.toLowerCase();
                const matchSearch =
                    p.name.toLowerCase().includes(term) ||
                    (p.myCode && p.myCode.toLowerCase().includes(term)) ||
                    (p.supplierCode && p.supplierCode.toLowerCase().includes(term));

                const matchSupplier = filterSupplier === 'all' || p.supplier === filterSupplier;
                const matchAvailable = filterAvailable === 'all' ||
                    (filterAvailable === 'yes' && p.available) ||
                    (filterAvailable === 'no' && !p.available);
                const matchPublished = filterPublished === 'all' ||
                    (filterPublished === 'yes' && p.published) ||
                    (filterPublished === 'no' && !p.published);

                const price = parseFloat(p.rrp) || parseFloat(p.basePrice) || 0;
                const minPrice = parseFloat(filterPriceMin) || 0;
                const maxPrice = parseFloat(filterPriceMax) || 999999;
                const matchPrice = price >= minPrice && price <= maxPrice;

                const matchBrand = !filterBrand || (p.vendor && p.vendor.toLowerCase().includes(filterBrand.toLowerCase()));

                return matchSearch && matchSupplier && matchAvailable && matchPublished && matchPrice && matchBrand;
            });

            // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
            const sortedProducts = [...filteredProducts].sort((a, b) => {
                const priceA = parseFloat(a.rrp) || parseFloat(a.basePrice) || 0;
                const priceB = parseFloat(b.rrp) || parseFloat(b.basePrice) || 0;

                switch(sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'price-asc':
                        return priceA - priceB;
                    case 'price-desc':
                        return priceB - priceA;
                    case 'date':
                    default:
                        return new Date(b.addedDate) - new Date(a.addedDate);
                }
            });

            const resetFilters = () => {
                setSearchTerm('');
                setFilterSupplier('all');
                setFilterAvailable('all');
                setFilterPublished('all');
                setFilterPriceMin('');
                setFilterPriceMax('');
                setFilterBrand('');
                setSortBy('date');
            };

            const stats = {
                totalProducts: products.length,
                availableProducts: products.filter(p => p.available).length,
                publishedProducts: products.filter(p => p.published).length,
                totalOrders: orders.length,
                newOrders: orders.filter(o => o.status === 'new').length,
                completedOrders: orders.filter(o => o.status === 'completed').length,
                totalProfit: orders.filter(o => o.status === 'completed').reduce((sum, o) => sum + (o.price - o.cost), 0),
                tasksCompleted: dailyTasks.filter(t => t.done).length,
                tasksTotal: dailyTasks.length
            };

            // –£–Ω—ñ–∫–∞–ª—å–Ω—ñ –±—Ä–µ–Ω–¥–∏ —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑ –Ω–∞—è–≤–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤
            const uniqueBrands = [...new Set(products.map(p => p.vendor).filter(Boolean))].sort();
            const uniqueCategoriesFromProducts = [...new Set(products.map(p => p.category).filter(Boolean))].sort();

            // –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É –≤—Ä—É—á–Ω—É (–ø–æ–ª—è —è–∫ —É XML)
            const addManualProduct = () => {
                const mp = {...manualProduct};
                mp.id = `${Date.now()}-manual`;
                if (!mp.myCode) mp.myCode = generateMyCode(mp.supplier || 'MAN');
                if (!mp.rrp || mp.rrp === '') {
                    mp.rrp = calculateRRP(mp.basePrice || 0);
                }
                setProducts(prev => [mp, ...prev]);
                if (mp.supplier) setSuppliers(prev => Array.from(new Set([mp.supplier, ...prev])));
                setManualProduct({
                    name: '', supplier: '', supplierCode: '', basePrice: '', rrp: '', image: '', vendor: '', category: '', available: true, published: false, customPrice: false
                });
                setShowAddProductModal(false);
                alert('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–¥–∞–Ω–æ –≤—Ä—É—á–Ω—É');
            };

            return (
                <div className="min-h-screen bg-gray-50 pb-24">
                    {/* –í–µ—Ä—Ö–Ω—è –ø–∞–Ω–µ–ª—å –∑—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ—é */}
                    <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 sticky top-0 z-40 shadow-lg">
                        <h1 className="text-xl font-bold mb-3">üöÄ CRM –î—Ä–æ–ø—à–∏–ø—ñ–Ω–≥ Pro LaVok SHOP by Koval</h1>
                        <div className="grid grid-cols-4 gap-2 text-center">
                            <div className="bg-white/20 backdrop-blur rounded-lg p-2">
                                <div className="text-xs opacity-90">–¢–æ–≤–∞—Ä—ñ–≤</div>
                                <div className="text-lg font-bold">{stats.totalProducts}</div>
                            </div>
                            <div className="bg-white/20 backdrop-blur rounded-lg p-2">
                                <div className="text-xs opacity-90">–ó–∞–º–æ–≤–ª–µ–Ω—å</div>
                                <div className="text-lg font-bold">{stats.totalOrders}</div>
                            </div>
                            <div className="bg-white/20 backdrop-blur rounded-lg p-2">
                                <div className="text-xs opacity-90">–ó–∞–≤–¥–∞–Ω—å</div>
                                <div className="text-lg font-bold">{stats.tasksCompleted}/{stats.tasksTotal}</div>
                            </div>
                            <div className="bg-white/20 backdrop-blur rounded-lg p-2">
                                <div className="text-xs opacity-90">–ü—Ä–∏–±—É—Ç–æ–∫</div>
                                <div className="text-lg font-bold">{stats.totalProfit}‚Ç¥</div>
                            </div>
                        </div>
                    </div>

                    {/* –ö–æ–Ω—Ç–µ–Ω—Ç */}
                    <div className="p-4">
                        {/* –¢–û–í–ê–†–ò */}
                        {activeTab === 'products' && (
                            <>
                                <div className="bg-white rounded-lg shadow-sm p-4 mb-4">
                                    <div className="flex gap-2 mb-3">
                                        <label className="flex-1 bg-blue-600 text-white py-3 rounded-lg flex items-center justify-center gap-2 cursor-pointer">
                                            <UploadIcon size={20} />
                                            {loading ? '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...' : 'XML'}
                                            <input type="file" accept=".xml" onChange={handleFileUpload} className="hidden" disabled={loading} />
                                        </label>

                                        <button
                                            onClick={() => setShowAddProductModal(true)}
                                            className="bg-green-600 text-white py-3 rounded-lg flex items-center justify-center gap-2 px-4"
                                        >
                                            <PlusIcon size={18} />
                                            –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä
                                        </button>

                                        <button
                                            onClick={() => setShowTemplatesModal(true)}
                                            className="flex-1 bg-purple-600 text-white py-3 rounded-lg flex items-center justify-center gap-2"
                                        >
                                            <MessageSquareIcon size={20} />
                                            –®–∞–±–ª–æ–Ω–∏
                                        </button>
                                    </div>

                                    {/* –ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞—Ü—ñ–Ω–∫–∏ */}
                                    <div className="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-3 mb-3 border border-green-200">
                                        <label className="text-sm font-medium text-gray-700 mb-2 block">
                                            üí∞ –ù–∞—Ü–µ–Ω–∫–∞ –Ω–∞ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏: {priceMarkup}%
                                        </label>
                                        <div className="flex items-center gap-3">
                                            <input
                                                type="range"
                                                min="0"
                                                max="200"
                                                step="5"
                                                value={priceMarkup}
                                                onChange={(e) => {
                                                    const newMarkup = parseInt(e.target.value);
                                                    applyMarkupToAll(newMarkup);
                                                }}
                                                className="flex-1"
                                            />
                                            <input
                                                type="number"
                                                value={priceMarkup}
                                                onChange={(e) => {
                                                    const newMarkup = parseInt(e.target.value) || 0;
                                                    if (newMarkup >= 0 && newMarkup <= 500) {
                                                        applyMarkupToAll(newMarkup);
                                                    }
                                                }}
                                                className="w-16 px-2 py-1 border rounded text-center"
                                            />
                                            <span className="text-xs text-gray-600">%</span>
                                        </div>
                                        <p className="text-xs text-gray-600 mt-2">
                                            üí° –ù–∞–ø—Ä–∏–∫–ª–∞–¥: 100‚Ç¥ + {priceMarkup}% = {calculateRRP(100)}‚Ç¥
                                        </p>
                                    </div>

                                    <div className="relative mb-3">
                                        <SearchIcon size={20} className="absolute left-3 top-3 text-gray-400" />
                                        <input
                                            type="text"
                                            placeholder="–ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—É..."
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                            className="w-full pl-10 pr-4 py-3 border rounded-lg"
                                        />
                                    </div>

                                    <div className="flex items-center justify-between gap-2">
                                        <div className="grid grid-cols-3 gap-2 w-full">
                                            <select value={filterSupplier} onChange={(e) => setFilterSupplier(e.target.value)} className="px-2 py-2 border rounded-lg text-sm">
                                                <option value="all">–í—Å—ñ –ø–æ—Å—Ç–∞—á.</option>
                                                {suppliers.map(s => <option key={s} value={s}>{s}</option>)}
                                            </select>
                                            <select value={filterAvailable} onChange={(e) => setFilterAvailable(e.target.value)} className="px-2 py-2 border rounded-lg text-sm">
                                                <option value="all">–í—Å—ñ</option>
                                                <option value="yes">‚úÖ –Ñ</option>
                                                <option value="no">‚ùå –ù–µ–º–∞—î</option>
                                            </select>
                                            <select value={filterPublished} onChange={(e) => setFilterPublished(e.target.value)} className="px-2 py-2 border rounded-lg text-sm">
                                                <option value="all">–í—Å—ñ</option>
                                                <option value="yes">üì± –û–ø—É–±–ª.</option>
                                                <option value="no">‚è∏Ô∏è –ù–µ –æ–ø—É–±–ª.</option>
                                            </select>
                                        </div>

                                        <button onClick={() => setShowAdvancedFilters(!showAdvancedFilters)} className="text-xs text-gray-600 underline">
                                            {showAdvancedFilters ? '–°—Ö–æ–≤–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏' : '–†–æ–∑—à–∏—Ä–µ–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏'}
                                        </button>
                                    </div>

                                    {showAdvancedFilters && (
                                        <div className="mt-3 grid grid-cols-3 gap-2">
                                            <input type="number" placeholder="–¶—ñ–Ω–∞ min" value={filterPriceMin}
                                                onChange={(e) => setFilterPriceMin(e.target.value)} className="px-2 py-2 border rounded" />
                                            <input type="number" placeholder="–¶—ñ–Ω–∞ max" value={filterPriceMax}
                                                onChange={(e) => setFilterPriceMax(e.target.value)} className="px-2 py-2 border rounded" />
                                            <input type="text" placeholder="–ë—Ä–µ–Ω–¥ / –í–∏—Ä–æ–±–Ω–∏–∫" value={filterBrand}
                                                onChange={(e) => setFilterBrand(e.target.value)} className="px-2 py-2 border rounded" />
                                            <select value={sortBy} onChange={(e) => setSortBy(e.target.value)} className="px-2 py-2 border rounded col-span-1">
                                                <option value="date">–°–æ—Ä—Ç—É–≤–∞—Ç–∏: –∑–∞ –¥–∞—Ç–æ—é</option>
                                                <option value="name">–°–æ—Ä—Ç—É–≤–∞—Ç–∏: –Ω–∞–∑–≤–∞</option>
                                                <option value="price-asc">–°–æ—Ä—Ç—É–≤–∞—Ç–∏: —Ü—ñ–Ω–∞ ‚Üë</option>
                                                <option value="price-desc">–°–æ—Ä—Ç—É–≤–∞—Ç–∏: —Ü—ñ–Ω–∞ ‚Üì</option>
                                            </select>
                                            <select multiple value={uniqueCategoriesFromProducts} onChange={() => {}} className="px-2 py-2 border rounded col-span-2 text-xs">
                                                {uniqueCategoriesFromProducts.length === 0 ? <option disabled>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –≤—ñ–¥—Å—É—Ç–Ω—ñ</option> : uniqueCategoriesFromProducts.map(c => <option key={c} value={c}>{c}</option>)}
                                            </select>
                                            <div className="flex gap-2">
                                                <button onClick={resetFilters} className="px-3 py-2 bg-gray-200 rounded">–°–∫–∏–Ω—É—Ç–∏</button>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {loading ? (
                                    <div className="bg-white rounded-lg p-12 text-center">
                                        <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"></div>
                                        <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
                                    </div>
                                ) : sortedProducts.length === 0 ? (
                                    <div className="bg-white rounded-lg p-8 text-center">
                                        <PackageIcon size={48} className="mx-auto text-gray-300 mb-3" />
                                        <p className="text-gray-600">{products.length === 0 ? '–ó–∞–≤–∞–Ω—Ç–∞–∂ XML —Ñ–∞–π–ª –∞–±–æ –¥–æ–¥–∞–π —Ç–æ–≤–∞—Ä –≤—Ä—É—á–Ω—É' : '–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'}</p>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        {sortedProducts.map(product => {
                                            const basePrice = parseFloat(product.basePrice) || 0;
                                            const displayRRP = parseFloat(product.rrp) || basePrice;

                                            return (
                                            <div key={product.id} className="bg-white rounded-lg shadow-sm p-3">
                                                <div className="flex gap-3 mb-2">
                                                    {product.image ? (
                                                        <img src={product.image} alt={product.name} className="w-20 h-20 object-cover rounded" onError={(e) => e.target.style.display = 'none'} />
                                                    ) : (
                                                        <div className="w-20 h-20 bg-gray-200 rounded flex items-center justify-center">
                                                            <PackageIcon size={24} className="text-gray-400" />
                                                        </div>
                                                    )}
                                                    <div className="flex-1 min-w-0">
                                                        {product.supplierUrl ? (
                                                            <a
                                                                href={product.supplierUrl}
                                                                target="_blank"
                                                                rel="noopener noreferrer"
                                                                className="font-bold text-sm text-blue-600 hover:underline block truncate"
                                                            >
                                                                {product.name}
                                                            </a>
                                                        ) : (
                                                            <h3 className="font-bold text-sm truncate">{product.name}</h3>
                                                        )}
                                                        <p className="text-xs text-gray-500 mb-1">
                                                            üî¢ –ú—ñ–π: {product.myCode} | –ü–æ—Å—Ç–∞—á: {product.supplierCode} {product.category ? `| –ö–∞—Ç–µ–≥.: ${product.category}` : ''}
                                                        </p>
                                                        <div className="flex gap-1">
                                                            <span className={`px-2 py-0.5 rounded text-xs ${product.available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                                {product.available ? '‚úÖ' : '‚ùå'}
                                                            </span>
                                                            <span className={`px-2 py-0.5 rounded text-xs ${product.published ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}`}>
                                                                {product.published ? 'üì±' : '‚è∏Ô∏è'}
                                                            </span>
                                                            {product.customPrice && (
                                                                <span className="px-2 py-0.5 rounded text-xs bg-purple-100 text-purple-800">
                                                                    ‚úèÔ∏è
                                                                </span>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="bg-gradient-to-r from-green-50 to-blue-50 rounded p-3 text-center border border-green-200">
                                                    <div className="text-xs text-gray-600 mb-1">–†–†–¶</div>
                                                    <div className="text-2xl font-bold text-green-600">
                                                        {displayRRP.toFixed(2)} ‚Ç¥
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-3 gap-1 mt-2">
                                                    <button onClick={() => { setEditingProduct({...product}); setShowEditModal(true); }} className="bg-blue-600 text-white py-2 rounded text-xs">
                                                        –ó–º—ñ–Ω–∏—Ç–∏
                                                    </button>
                                                    <button onClick={() => { setSelectedProduct(product); setShowPostModal(true); }} className="bg-purple-600 text-white py-2 rounded text-xs">
                                                        –ü–æ—Å—Ç–∏
                                                    </button>
                                                    <button onClick={() => createOrder(product)} className="bg-green-600 text-white py-2 rounded text-xs">
                                                        –ó–∞–º–æ–≤–∏—Ç–∏
                                                    </button>
                                                </div>
                                            </div>
                                        )})}
                                    </div>
                                )}
                            </>
                        )}

                        {/* –ó–ê–ú–û–í–õ–ï–ù–ù–Ø */}
                        {activeTab === 'orders' && (
                            <div className="space-y-3">
                                <button
                                    onClick={() => {
                                        setNewOrder({
                                            id: Date.now().toString(),
                                            productId: '',
                                            productName: '',
                                            customerName: '',
                                            customerPhone: '',
                                            deliveryAddress: '',
                                            price: 0,
                                            cost: 0,
                                            ttn: '',
                                            status: 'new',
                                            createdAt: new Date().toISOString()
                                        });
                                        setShowOrderModal(true);
                                    }}
                                    className="w-full bg-green-600 text-white py-3 rounded-lg flex items-center justify-center gap-2 shadow-sm"
                                >
                                    <PlusIcon size={20} />
                                    –ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                                </button>

                                {orders.length === 0 ? (
                                    <div className="bg-white rounded-lg p-8 text-center">
                                        <ShoppingBagIcon size={48} className="mx-auto text-gray-300 mb-3" />
                                        <p className="text-gray-600">–ó–∞–º–æ–≤–ª–µ–Ω—å –ø–æ–∫–∏ –Ω–µ–º–∞—î</p>
                                        <p className="text-xs text-gray-500 mt-2">–ù–∞—Ç–∏—Å–Ω–∏ "–ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è" —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏</p>
                                    </div>
                                ) : (
                                    [...orders].reverse().map(order => (
                                        <div key={order.id} className="bg-white rounded-lg p-4 shadow-sm">
                                            <div className="flex justify-between items-start mb-2">
                                                <div>
                                                    <h3 className="font-semibold text-sm">{order.productName}</h3>
                                                    <p className="text-xs text-gray-600">{order.customerName}</p>
                                                    <p className="text-xs text-gray-600">{order.customerPhone}</p>
                                                </div>
                                                <select value={order.status} onChange={(e) => updateOrderStatus(order.id, e.target.value)}
                                                    className={`px-2 py-1 rounded text-xs font-medium ${
                                                        order.status === 'new' ? 'bg-blue-100 text-blue-800' :
                                                        order.status === 'sent' ? 'bg-yellow-100 text-yellow-800' :
                                                        order.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                                    }`}>
                                                    <option value="new">–ù–æ–≤–µ</option>
                                                    <option value="sent">–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ</option>
                                                    <option value="completed">–í–∏–∫–æ–Ω–∞–Ω–æ</option>
                                                    <option value="cancelled">–°–∫–∞—Å–æ–≤–∞–Ω–æ</option>
                                                </select>
                                            </div>
                                            <div className="flex gap-3 text-xs mb-2">
                                                <span>üí∞ {order.price}‚Ç¥</span>
                                                <span className="text-green-600">üíµ +{order.price - order.cost}‚Ç¥</span>
                                            </div>
                                            <div className="flex gap-2">
                                                <input type="text" placeholder="–¢–¢–ù..." value={order.ttn || ''}
                                                    onChange={(e) => updateOrderTTN(order.id, e.target.value)}
                                                    className="flex-1 px-3 py-2 border rounded text-sm" />
                                                {order.ttn && (
                                                    <a href={`https://novaposhta.ua/tracking/?cargo_number=${order.ttn}`} target="_blank"
                                                        className="bg-orange-600 text-white px-3 py-2 rounded flex items-center">
                                                        <TruckIcon size={16} />
                                                    </a>
                                                )}
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        )}

                        {/* –ó–ê–í–î–ê–ù–ù–Ø */}
                        {activeTab === 'tasks' && (
                            <div className="space-y-3">
                                <div className="bg-white rounded-lg p-4 shadow-sm">
                                    <div className="flex justify-between items-center mb-3">
                                        <h2 className="font-bold">‚úÖ –©–æ–¥–µ–Ω–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</h2>
                                        <span className="text-sm text-gray-600">{stats.tasksCompleted}/{stats.tasksTotal}</span>
                                    </div>
                                    <div className="space-y-2">
                                        {dailyTasks.map(task => (
                                            <label key={task.id} className={`flex items-center gap-3 p-3 rounded border-2 cursor-pointer ${
                                                task.done ? 'bg-green-50 border-green-200' : 'bg-white border-gray-200'
                                            }`}>
                                                <input type="checkbox" checked={task.done}
                                                    onChange={() => setDailyTasks(dailyTasks.map(t => t.id === task.id ? {...t, done: !t.done} : t))}
                                                    className="w-5 h-5" />
                                                <span className={`flex-1 text-sm ${task.done ? 'line-through text-gray-500' : ''}`}>
                                                    {task.title}
                                                </span>
                                            </label>
                                        ))}
                                    </div>
                                    <button onClick={() => { initializeDailyTasks(); alert('‚úÖ –ó–∞–≤–¥–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–æ!'); }}
                                        className="w-full mt-3 bg-blue-600 text-white py-2 rounded">
                                        üîÑ –°–∫–∏–Ω—É—Ç–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
                                    </button>
                                </div>

                                <div className="bg-white rounded-lg p-4 shadow-sm">
                                    <h2 className="font-bold mb-3">üìÖ –¢–∏–∂–Ω–µ–≤—ñ —Ü—ñ–ª—ñ</h2>
                                    <div className="space-y-3">
                                        {weeklyGoals.map(goal => (
                                            <div key={goal.id}>
                                                <div className="flex justify-between mb-1">
                                                    <span className="text-sm">{goal.title}</span>
                                                    <span className="text-sm font-bold text-blue-600">{goal.current}/{goal.target}</span>
                                                </div>
                                                <div className="bg-gray-200 rounded-full h-2 mb-2">
                                                    <div className="bg-blue-600 h-2 rounded-full" style={{width: `${Math.min((goal.current / goal.target) * 100, 100)}%`}}></div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button onClick={() => setWeeklyGoals(weeklyGoals.map(g => g.id === goal.id ? {...g, current: Math.min(g.current + 1, g.target)} : g))}
                                                        className="flex-1 bg-green-600 text-white py-1 rounded text-sm">+1</button>
                                                    <button onClick={() => setWeeklyGoals(weeklyGoals.map(g => g.id === goal.id ? {...g, current: Math.max(g.current - 1, 0)} : g))}
                                                        className="flex-1 bg-red-600 text-white py-1 rounded text-sm">-1</button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */}
                        {activeTab === 'stats' && (
                            <div className="space-y-3">
                                <div className="bg-white rounded-lg p-4 shadow-sm">
                                    <h3 className="font-bold mb-3">üìä –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                                    <div className="space-y-2 text-sm">
                                        <div className="flex justify-between">
                                            <span>–¢–æ–≤–∞—Ä—ñ–≤:</span>
                                            <strong className="text-blue-600">{stats.totalProducts}</strong>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ:</span>
                                            <strong className="text-green-600">{stats.availableProducts}</strong>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ:</span>
                                            <strong className="text-purple-600">{stats.publishedProducts}</strong>
                                        </div>
                                        <div className="flex justify-between border-t pt-2">
                                            <span>–ó–∞–º–æ–≤–ª–µ–Ω—å:</span>
                                            <strong className="text-blue-600">{stats.totalOrders}</strong>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>–ù–æ–≤–∏—Ö:</span>
                                            <strong className="text-yellow-600">{stats.newOrders}</strong>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>–í–∏–∫–æ–Ω–∞–Ω–æ:</span>
                                            <strong className="text-green-600">{stats.completedOrders}</strong>
                                        </div>
                                        <div className="flex justify-between border-t pt-2">
                                            <span>–ü—Ä–∏–±—É—Ç–æ–∫:</span>
                                            <strong className="text-green-600 text-lg">{stats.totalProfit} ‚Ç¥</strong>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg p-4 shadow-sm">
                                    <h3 className="font-bold mb-3">üíæ –ë–µ–∫–∞–ø –¥–∞–Ω–∏—Ö</h3>
                                    <button onClick={exportBackup} className="w-full bg-green-600 text-white py-3 rounded-lg mb-2 flex items-center justify-center gap-2">
                                        <DownloadIcon size={20} />
                                        –°—Ç–≤–æ—Ä–∏—Ç–∏ –±–µ–∫–∞–ø
                                    </button>
                                    <label className="w-full bg-purple-600 text-white py-3 rounded-lg flex items-center justify-center gap-2 cursor-pointer">
                                        üì• –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∑ –±–µ–∫–∞–ø—É
                                        <input type="file" accept=".json" onChange={importBackup} className="hidden" />
                                    </label>
                                </div>

                                <div className="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-4 border border-green-200">
                                    <h3 className="font-bold mb-2">üí° –ü–æ—Ä–∞–¥–∞</h3>
                                    <p className="text-sm text-gray-700">
                                        üíæ –°—Ç–≤–æ—Ä—é–π –±–µ–∫–∞–ø —â–æ—Ç–∏–∂–Ω—è! –ó–±–µ—Ä—ñ–≥–∞–π —Ñ–∞–π–ª –≤ Google Drive –∞–±–æ —Ö–º–∞—Ä—ñ –¥–ª—è –±–µ–∑–ø–µ–∫–∏.
                                    </p>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* –ú–û–î–ê–õ–ö–ê –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø */}
                    {showEditModal && editingProduct && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-end modal-overlay">
                            <div className="bg-white rounded-t-2xl w-full max-h-[90vh] overflow-y-auto modal-content">
                                <div className="sticky top-0 bg-white border-b px-4 py-3 flex items-center justify-between">
                                    <h3 className="font-semibold">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</h3>
                                    <button onClick={() => setShowEditModal(false)} className="p-2">
                                        <XIcon size={20} />
                                    </button>
                                </div>
                                <div className="p-4 space-y-3">
                                    {editingProduct.image && (
                                        <img src={editingProduct.image} alt="" className="max-w-full h-32 object-contain mx-auto" />
                                    )}
                                    <div className="bg-blue-50 rounded p-2 text-xs">
                                        <div className="mb-1">–ú—ñ–π –∫–æ–¥: <strong>{editingProduct.myCode}</strong></div>
                                        <div className="mb-1">–ö–æ–¥ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞: <strong>{editingProduct.supplierCode}</strong></div>
                                        <div>–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫: <strong>{editingProduct.supplier}</strong></div>
                                    </div>
                                    <input type="text" value={editingProduct.name}
                                        onChange={(e) => setEditingProduct({...editingProduct, name: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg" placeholder="–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É" />
                                    <input type="url" value={editingProduct.supplierUrl || ''}
                                        onChange={(e) => setEditingProduct({...editingProduct, supplierUrl: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg" placeholder="–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–æ–≤–∞—Ä" />

                                    <input type="text" value={editingProduct.category || ''}
                                        onChange={(e) => setEditingProduct({...editingProduct, category: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg" placeholder="–ö–∞—Ç–µ–≥–æ—Ä—ñ—è" />

                                    <div className="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-4 border border-green-200">
                                        <label className="text-sm font-medium text-gray-700 block mb-2">
                                            üí∞ –†–†–¶ (—Ü—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É)
                                        </label>
                                        <input type="number" value={editingProduct.rrp || ''}
                                            onChange={(e) => setEditingProduct({...editingProduct, rrp: parseFloat(e.target.value) || 0, customPrice: true})}
                                            className="w-full px-4 py-3 border-2 border-green-300 rounded-lg text-xl font-bold text-center"
                                            placeholder="0" />
                                        <p className="text-xs text-gray-600 mt-2 text-center">
                                            üí° –ë–∞–∑–æ–≤–∞ —Ü—ñ–Ω–∞ –∑ XML: {editingProduct.basePrice}‚Ç¥
                                        </p>
                                        {editingProduct.customPrice && (
                                            <button
                                                onClick={() => setEditingProduct({
                                                    ...editingProduct,
                                                    rrp: calculateRRP(editingProduct.basePrice),
                                                    customPrice: false
                                                })}
                                                className="w-full mt-2 bg-gray-200 text-gray-700 py-2 rounded text-sm"
                                            >
                                                üîÑ –°–∫–∏–Ω—É—Ç–∏ –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É ({calculateRRP(editingProduct.basePrice).toFixed(2)}‚Ç¥)
                                            </button>
                                        )}
                                    </div>
                                    <label className="flex items-center gap-3 p-3 border rounded cursor-pointer">
                                        <input type="checkbox" checked={editingProduct.available}
                                            onChange={(e) => setEditingProduct({...editingProduct, available: e.target.checked})}
                                            className="w-5 h-5" />
                                        <span>‚úÖ –Ñ –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</span>
                                    </label>
                                    <label className="flex items-center gap-3 p-3 border rounded cursor-pointer">
                                        <input type="checkbox" checked={editingProduct.published}
                                            onChange={(e) => setEditingProduct({...editingProduct, published: e.target.checked})}
                                            className="w-5 h-5" />
                                        <span>üì± –û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ</span>
                                    </label>
                                    <div className="flex gap-3 pt-3">
                                        <button onClick={() => setShowEditModal(false)} className="flex-1 bg-gray-200 py-3 rounded-lg">
                                            –°–∫–∞—Å—É–≤–∞—Ç–∏
                                        </button>
                                        <button onClick={() => { updateProduct(editingProduct.id, editingProduct); setShowEditModal(false); alert('‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ!'); }}
                                            className="flex-1 bg-blue-600 text-white py-3 rounded-lg">
                                            –ó–±–µ—Ä–µ–≥—Ç–∏
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* –ú–û–î–ê–õ–ö–ê –ü–û–°–¢–Ü–í */}
                    {showPostModal && selectedProduct && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-end modal-overlay">
                            <div className="bg-white rounded-t-2xl w-full max-h-[90vh] overflow-y-auto modal-content">
                                <div className="sticky top-0 bg-white border-b px-4 py-3 flex items-center justify-between">
                                    <h3 className="font-semibold">üì± –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø–æ—Å—Ç—ñ–≤</h3>
                                    <button onClick={() => setShowPostModal(false)} className="p-2">
                                        <XIcon size={20} />
                                    </button>
                                </div>
                                <div className="p-4 space-y-4">
                                    {selectedProduct.image && (
                                        <div>
                                            <img src={selectedProduct.image} alt="" className="w-full max-h-48 object-contain bg-gray-50 rounded" />
                                            <p className="text-xs text-gray-500 text-center mt-1">üí° –ó–±–µ—Ä–µ–∂–∏ —Ñ–æ—Ç–æ –¥–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó</p>
                                        </div>
                                    )}
                                    <div className="bg-gray-50 rounded p-3">
                                        <h4 className="font-bold text-sm">{selectedProduct.name}</h4>
                                        <p className="text-sm text-gray-600">üí∞ {selectedProduct.rrp || selectedProduct.dropPrice} ‚Ç¥</p>
                                    </div>
                                    {['instagram', 'facebook', 'tiktok'].map(platform => (
                                        <div key={platform} className="border rounded-lg p-3">
                                            <div className="flex justify-between items-center mb-2">
                                                <span className="font-semibold capitalize">
                                                    {platform === 'instagram' && 'üì∏ Instagram'}
                                                    {platform === 'facebook' && 'üë• Facebook'}
                                                    {platform === 'tiktok' && 'üéµ TikTok'}
                                                </span>
                                                <button onClick={() => {
                                                    navigator.clipboard.writeText(generatePost(selectedProduct, platform));
                                                    updateProduct(selectedProduct.id, {published: true});
                                                    alert(`‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!\n–¢–æ–≤–∞—Ä –≤—ñ–¥–º—ñ—á–µ–Ω–æ —è–∫ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ.`);
                                                }} className="bg-blue-600 text-white px-3 py-1 rounded text-sm flex items-center gap-1">
                                                    <CopyIcon size={14} />
                                                    –ö–æ–ø—ñ—é–≤–∞—Ç–∏
                                                </button>
                                            </div>
                                            <textarea readOnly value={generatePost(selectedProduct, platform)}
                                                className="w-full text-xs bg-gray-50 p-2 rounded border resize-none" rows="8" />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* –ú–û–î–ê–õ–ö–ê –ó–ê–ú–û–í–õ–ï–ù–ù–Ø */}
                    {showOrderModal && newOrder && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-end modal-overlay">
                            <div className="bg-white rounded-t-2xl w-full max-h-[90vh] overflow-y-auto modal-content">
                                <div className="sticky top-0 bg-white border-b px-4 py-3 flex items-center justify-between">
                                    <h3 className="font-semibold">üõçÔ∏è –ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
                                    <button onClick={() => setShowOrderModal(false)} className="p-2">
                                        <XIcon size={20} />
                                    </button>
                                </div>
                                <div className="p-4 space-y-3">
                                    {newOrder.productName ? (
                                        <div className="bg-blue-50 rounded p-3">
                                            <p className="font-semibold text-sm">{newOrder.productName}</p>
                                            <p className="text-sm">–¶—ñ–Ω–∞: {newOrder.price} ‚Ç¥</p>
                                        </div>
                                    ) : (
                                        <input
                                            type="text"
                                            placeholder="–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É *"
                                            value={newOrder.productName}
                                            onChange={(e) => setNewOrder({...newOrder, productName: e.target.value})}
                                            className="w-full px-4 py-3 border rounded-lg"
                                        />
                                    )}
                                    <input type="text" placeholder="–Ü–º'—è –∫–ª—ñ—î–Ω—Ç–∞ *" value={newOrder.customerName}
                                        onChange={(e) => setNewOrder({...newOrder, customerName: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg" />
                                    <input type="tel" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω *" value={newOrder.customerPhone}
                                        onChange={(e) => setNewOrder({...newOrder, customerPhone: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg" />
                                    <textarea placeholder="–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏" value={newOrder.deliveryAddress}
                                        onChange={(e) => setNewOrder({...newOrder, deliveryAddress: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg resize-none" rows="2" />
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="text-xs text-gray-600 block mb-1">–¶—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É, ‚Ç¥</label>
                                            <input type="number" placeholder="0" value={newOrder.price || ''}
                                                onChange={(e) => setNewOrder({...newOrder, price: parseFloat(e.target.value) || 0})}
                                                className="w-full px-4 py-3 border rounded-lg" />
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-600 block mb-1">–°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å, ‚Ç¥</label>
                                            <input type="number" placeholder="0" value={newOrder.cost || ''}
                                                onChange={(e) => setNewOrder({...newOrder, cost: parseFloat(e.target.value) || 0})}
                                                className="w-full px-4 py-3 border rounded-lg" />
                                        </div>
                                    </div>
                                    {newOrder.price > 0 && newOrder.cost > 0 && (
                                        <div className="bg-green-50 rounded p-3 text-center">
                                            <span className="text-sm">–¢–≤—ñ–π –ø—Ä–∏–±—É—Ç–æ–∫:</span>
                                            <span className="text-xl font-bold text-green-600 ml-2">
                                                {newOrder.price - newOrder.cost} ‚Ç¥
                                            </span>
                                        </div>
                                    )}
                                    <div className="flex gap-3">
                                        <button onClick={() => setShowOrderModal(false)} className="flex-1 bg-gray-200 py-3 rounded-lg">
                                            –°–∫–∞—Å—É–≤–∞—Ç–∏
                                        </button>
                                        <button onClick={saveOrder} className="flex-1 bg-green-600 text-white py-3 rounded-lg">
                                            –°—Ç–≤–æ—Ä–∏—Ç–∏
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* –ú–û–î–ê–õ–ö–ê –®–ê–ë–õ–û–ù–Ü–í */}
                    {showTemplatesModal && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-end modal-overlay">
                            <div className="bg-white rounded-t-2xl w-full max-h-[90vh] overflow-y-auto modal-content">
                                <div className="sticky top-0 bg-white border-b px-4 py-3 flex items-center justify-between z-10">
                                    <h3 className="font-semibold">üí¨ –®–∞–±–ª–æ–Ω–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π</h3>
                                    <button onClick={() => setShowTemplatesModal(false)} className="p-2">
                                        <XIcon size={20} />
                                    </button>
                                </div>
                                <div className="p-4 space-y-3">
                                    {[
                                        {title: 'üëã –ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è', text: '–ü—Ä–∏–≤—ñ—Ç! üëã\n–î—è–∫—É—é –∑–∞ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è!\n–ß–∏–º –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏? üòä'},
                                        {title: 'üì¶ –î–æ—Å—Ç–∞–≤–∫–∞', text: '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –£–∫—Ä–∞—ó–Ω—ñ üá∫üá¶\n\n‚úÖ –ù–æ–≤–∞ –ü–æ—à—Ç–∞ (2-3 –¥–Ω—ñ)\nüí∞ –û–ø–ª–∞—Ç–∞: –ü–µ—Ä–µ–¥–ø–ª–∞—Ç–∞ –∞–±–æ –Ω–∞–∫–ª–∞–¥–µ–Ω–∏–π –ø–ª–∞—Ç—ñ–∂\n\n–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ—Ç—è–≥–æ–º 1-2 –¥–Ω—ñ–≤! üì¶'},
                                        {title: '‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è', text: '‚úÖ –¢–≤–æ—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–µ!\n\n–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ—Ç—è–≥–æ–º 1-2 –¥–Ω—ñ–≤.\n–¢–¢–ù –Ω–∞–¥—ñ—à–ª—é –æ–¥—Ä–∞–∑—É! üöö'},
                                        {title: 'üöö –¢–¢–ù', text: 'üì¶ –¢–≤–æ—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!\n\n–¢–¢–ù: [–Ω–æ–º–µ—Ä]\n\n–í—ñ–¥—Å—Ç–µ–∂–∏—Ç–∏: novaposhta.ua\n\n–û—á—ñ–∫—É–π –Ω–∞ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—ñ! üòä'},
                                        {title: '‚≠ê –í—ñ–¥–≥—É–∫', text: '–°–ø–æ–¥—ñ–≤–∞—é—Å—å –≤—Å–µ —Å–ø–æ–¥–æ–±–∞–ª–æ—Å—å! üòä\n\n–ë—É–¥—É –≤–¥—è—á–Ω–∏–π –∑–∞ –≤—ñ–¥–≥—É–∫!\n–ú–æ–∂–Ω–∞ —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ? üì∏\n\n–ë–æ–Ω—É—Å: –∑–Ω–∏–∂–∫–∞ 10% –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—É –ø–æ–∫—É–ø–∫—É! üéÅ'},
                                        {title: '‚ùå –ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ', text: '–ù–∞ –∂–∞–ª—å, —Ü—å–æ–≥–æ –Ω–µ–º–∞—î üòî\n\n–ú–æ–∂—É –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏:\n1Ô∏è‚É£ [–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞]\n2Ô∏è‚É£ [–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞]\n\n–ê–±–æ –ø–æ–≤—ñ–¥–æ–º–ª—é –∫–æ–ª–∏ –∑\'—è–≤–∏—Ç—å—Å—è! üîî'}
                                    ].map((tmpl, idx) => (
                                        <div key={idx} className="border rounded-lg p-3">
                                            <h4 className="font-semibold text-sm mb-2">{tmpl.title}</h4>
                                            <textarea readOnly value={tmpl.text} className="w-full text-xs bg-gray-50 p-2 rounded border resize-none mb-2" rows="5" />
                                            <button onClick={() => { navigator.clipboard.writeText(tmpl.text); alert('‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!'); }}
                                                className="w-full bg-blue-600 text-white py-2 rounded flex items-center justify-center gap-2">
                                                <CopyIcon size={16} />
                                                –ö–æ–ø—ñ—é–≤–∞—Ç–∏
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* –ú–û–î–ê–õ–ö–ê –î–û–î–ê–í–ê–ù–ù–Ø –¢–û–í–ê–†–£ (—Ä—É—á–Ω–∞) */}
                    {showAddProductModal && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-end modal-overlay">
                            <div className="bg-white rounded-t-2xl w-full max-h-[90vh] overflow-y-auto modal-content">
                                <div className="sticky top-0 bg-white border-b px-4 py-3 flex items-center justify-between">
                                    <h3 className="font-semibold">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä –≤—Ä—É—á–Ω—É</h3>
                                    <button onClick={() => setShowAddProductModal(false)} className="p-2">
                                        <XIcon size={20} />
                                    </button>
                                </div>
                                <div className="p-4 space-y-3">
                                    <input type="text" placeholder="–ù–∞–∑–≤–∞" value={manualProduct.name || ''}
                                        onChange={(e) => setManualProduct({...manualProduct, name: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg" />
                                    <input type="text" placeholder="–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫" value={manualProduct.supplier || ''}
                                        onChange={(e) => setManualProduct({...manualProduct, supplier: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg" />
                                    <input type="text" placeholder="–ö–æ–¥ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞" value={manualProduct.supplierCode || ''}
                                        onChange={(e) => setManualProduct({...manualProduct, supplierCode: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg" />
                                    <input type="text" placeholder="–ë—Ä–µ–Ω–¥ / –í–∏—Ä–æ–±–Ω–∏–∫" value={manualProduct.vendor || ''}
                                        onChange={(e) => setManualProduct({...manualProduct, vendor: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg" />
                                    <input type="text" placeholder="–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ñ–æ—Ç–æ" value={manualProduct.image || ''}
                                        onChange={(e) => setManualProduct({...manualProduct, image: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg" />
                                    <input type="text" placeholder="–ö–∞—Ç–µ–≥–æ—Ä—ñ—è" value={manualProduct.category || ''}
                                        onChange={(e) => setManualProduct({...manualProduct, category: e.target.value})}
                                        className="w-full px-4 py-3 border rounded-lg" />
                                    <div className="grid grid-cols-2 gap-2">
                                        <input type="number" placeholder="–ó–∞–∫—É–ø. —Ü—ñ–Ω–∞ (basePrice)" value={manualProduct.basePrice || ''}
                                            onChange={(e) => setManualProduct({...manualProduct, basePrice: e.target.value})}
                                            className="w-full px-4 py-3 border rounded-lg" />
                                        <input type="number" placeholder="–†–†–¶ (rrp)" value={manualProduct.rrp || ''}
                                            onChange={(e) => setManualProduct({...manualProduct, rrp: e.target.value, customPrice: true})}
                                            className="w-full px-4 py-3 border rounded-lg" />
                                    </div>
                                    <label className="flex items-center gap-3">
                                        <input type="checkbox" checked={manualProduct.available} onChange={(e) => setManualProduct({...manualProduct, available: e.target.checked})} />
                                        –Ñ –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ
                                    </label>
                                    <label className="flex items-center gap-3">
                                        <input type="checkbox" checked={manualProduct.published} onChange={(e) => setManualProduct({...manualProduct, published: e.target.checked})} />
                                        –û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ
                                    </label>
                                    <div className="flex gap-3">
                                        <button onClick={() => setShowAddProductModal(false)} className="flex-1 bg-gray-200 py-3 rounded-lg">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                                        <button onClick={addManualProduct} className="flex-1 bg-green-600 text-white py-3 rounded-lg">–î–æ–¥–∞—Ç–∏</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* –ú–û–î–ê–õ–ö–ê –Ü–ú–ü–û–†–¢–£ XML –∑ –≤–∏–±–æ—Ä–æ–º –∫–∞—Ç–µ–≥–æ—Ä—ñ–π + —Ä–µ–∂–∏–º–æ–º —ñ–º–ø–æ—Ä—Ç—É */}
                    {showXmlImportModal && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-end modal-overlay">
                            <div className="bg-white rounded-t-2xl w-full max-h-[90vh] overflow-y-auto modal-content">
                                <div className="sticky top-0 bg-white border-b px-4 py-3 flex items-center justify-between">
                                    <h3 className="font-semibold">üì• –Ü–º–ø–æ—Ä—Ç XML ‚Äî –í–∏–±—ñ—Ä –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</h3>
                                    <button onClick={() => { setShowXmlImportModal(false); setXmlImportPreview([]); setXmlCategories([]); }} className="p-2">
                                        <XIcon size={20} />
                                    </button>
                                </div>
                                <div className="p-4 space-y-3">
                                    <p className="text-sm text-gray-600">–í–∏–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏. –ó–∞–ª–∏—à –ø—É—Å—Ç–∏–º –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É –≤—Å—ñ—Ö.</p>

                                    <div className="mb-2">
                                        <div className="text-xs font-medium mb-1">–†–µ–∂–∏–º —ñ–º–ø–æ—Ä—Ç—É:</div>
                                        <div className="flex gap-3 items-center">
                                            <label className="flex items-center gap-2">
                                                <input type="radio" name="xmlImportMode" value="all" checked={xmlImportMode === 'all'} onChange={() => setXmlImportMode('all')} />
                                                <span className="text-sm">–Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –≤—Å—ñ</span>
                                            </label>
                                            <label className="flex items-center gap-2">
                                                <input type="radio" name="xmlImportMode" value="onlyNew" checked={xmlImportMode === 'onlyNew'} onChange={() => setXmlImportMode('onlyNew')} />
                                                <span className="text-sm">–Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ (–±–µ–∑ –¥—É–±–ª—ñ–≤ –ø–æ supplierCode)</span>
                                            </label>
                                        </div>
                                        <p className="text-xs text-gray-500 mt-1">–Ø–∫—â–æ –≤–∏–±—Ä–∞–Ω–æ "—Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ", —Ç–æ–≤–∞—Ä–∏ –∑ supplierCode, —è–∫—ñ –≤–∂–µ —î —É —Ç–≤–æ—î–º—É CRM ‚Äî –±—É–¥—É—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω—ñ.</p>
                                    </div>

                                    <div className="grid grid-cols-2 gap-2">
                                        {xmlCategories.length === 0 ? (
                                            <div className="col-span-2 text-sm text-gray-500">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ ‚Äî –±—É–¥–µ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏</div>
                                        ) : xmlCategories.map(c => (
                                            <label key={c} className="flex items-center gap-2 p-2 border rounded">
                                                <input type="checkbox" checked={selectedXmlCategories.includes(c)} onChange={(e) => {
                                                    if (e.target.checked) setSelectedXmlCategories(prev => [...prev, c]);
                                                    else setSelectedXmlCategories(prev => prev.filter(x => x !== c));
                                                }} />
                                                <span className="text-sm truncate">{c}</span>
                                            </label>
                                        ))}
                                    </div>

                                    <div className="pt-3">
                                        <div className="text-sm font-medium mb-2">–ü–µ—Ä–µ–≥–ª—è–¥ (–ø–µ—Ä—à—ñ 10 —Ç–æ–≤–∞—Ä—ñ–≤):</div>
                                        <div className="space-y-2 max-h-40 overflow-y-auto">
                                            {xmlImportPreview.slice(0,10).map(p => (
                                                <div key={p.id} className="border rounded p-2 text-xs">
                                                    <div className="font-semibold truncate">{p.name}</div>
                                                    <div className="text-gray-500">{p.category} ‚Äî {p.rrp}‚Ç¥</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="flex gap-2 pt-4">
                                        <button onClick={() => { setSelectedXmlCategories([]); alert('üîÑ –û–±—Ä–∞–Ω–æ: –≤—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó'); }} className="flex-1 bg-gray-200 py-2 rounded">–û–±—Ä–∞—Ç–∏ –≤—Å—ñ</button>
                                        <button onClick={() => importSelectedXml()} className="flex-1 bg-green-600 text-white py-2 rounded">–Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* –ù–ò–ñ–ù–Ø –ù–ê–í–Ü–ì–ê–¶–Ü–Ø */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg z-40">
                        <div className="flex">
                            {[
                                {id: 'products', icon: PackageIcon, name: '–¢–æ–≤–∞—Ä–∏'},
                                {id: 'orders', icon: ShoppingBagIcon, name: '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è'},
                                {id: 'tasks', icon: CheckSquareIcon, name: '–ó–∞–≤–¥–∞–Ω–Ω—è'},
                                {id: 'stats', icon: BarChartIcon, name: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞'}
                            ].map(tab => (
                                <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                                    className={`flex-1 py-3 flex flex-col items-center gap-1 transition-colors relative ${
                                        activeTab === tab.id ? 'text-blue-600' : 'text-gray-600'
                                    }`}>
                                    <tab.icon size={24} />
                                    <span className="text-xs">{tab.name}</span>
                                    {tab.id === 'orders' && stats.newOrders > 0 && (
                                        <span className="absolute top-1 right-4 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                            {stats.newOrders}
                                        </span>
                                    )}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
