<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM –ü–∞–Ω–µ–ª—å</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@heroicons/react/24/outline/index.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    <script type="text/javascript">
        const { useState, useEffect } = React;
        const {
            PackageIcon, ShoppingBagIcon, CheckSquareIcon, BarChartIcon,
            XIcon, CopyIcon, DownloadIcon, TruckIcon
        } = HeroIcons;

        // ===== Helper Functions =====
        const generatePost = (product, platform) => {
            return `–¢–æ–≤–∞—Ä: ${product.name}\n–¶—ñ–Ω–∞: ${product.rrp || product.dropPrice}‚Ç¥\n–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${platform}`;
        };

        const calculateRRP = (basePrice) => parseFloat((basePrice * 1.3).toFixed(2));

        // ===== Main App =====
        function App() {
            const [activeTab, setActiveTab] = useState('products');
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [dailyTasks, setDailyTasks] = useState([]);
            const [weeklyGoals, setWeeklyGoals] = useState([]);
            const [stats, setStats] = useState({
                totalProducts: 0, availableProducts: 0, publishedProducts: 0,
                totalOrders: 0, newOrders: 0, completedOrders: 0, totalProfit: 0,
                tasksCompleted: 0, tasksTotal: 0
            });

            const [showEditModal, setShowEditModal] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [showPostModal, setShowPostModal] = useState(false);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [showOrderModal, setShowOrderModal] = useState(false);
            const [newOrder, setNewOrder] = useState({});
            const [showTemplatesModal, setShowTemplatesModal] = useState(false);
            const [showAddProductModal, setShowAddProductModal] = useState(false);
            const [newProduct, setNewProduct] = useState({});
            const [searchQuery, setSearchQuery] = useState('');
            const [filters, setFilters] = useState({ priceMin: '', priceMax: '', available: null, published: null });
            const [categories, setCategories] = useState([]);
            const [selectedCategories, setSelectedCategories] = useState([]);

            // ===== Effect: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –∑–∞–º–æ–≤–ª–µ–Ω—å =====
            useEffect(() => {
                const interval = setInterval(() => {
                    setOrders(prev => prev.map(order => {
                        if (order.status === 'new') {
                            return { ...order, status: 'sent' };
                        }
                        return order;
                    }));
                }, 30000); // 30 —Å–µ–∫—É–Ω–¥
                return () => clearInterval(interval);
            }, []);

            // ===== –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω—å =====
            const updateOrderStatus = (id, status) => {
                setOrders(prev => prev.map(o => o.id === id ? { ...o, status } : o));
            };
            const updateOrderTTN = (id, ttn) => {
                setOrders(prev => prev.map(o => o.id === id ? { ...o, ttn } : o));
            };
            const saveOrder = () => {
                setOrders([...orders, { ...newOrder, id: Date.now() }]);
                setNewOrder({});
                setShowOrderModal(false);
            };

            // ===== –§—ñ–ª—å—Ç—Ä–∏ =====
            const filteredProducts = products.filter(p => {
                const matchesSearch = p.name.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesPriceMin = filters.priceMin === '' || p.rrp >= parseFloat(filters.priceMin);
                const matchesPriceMax = filters.priceMax === '' || p.rrp <= parseFloat(filters.priceMax);
                const matchesAvailable = filters.available === null || p.available === filters.available;
                const matchesPublished = filters.published === null || p.published === filters.published;
                const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(p.category);
                return matchesSearch && matchesPriceMin && matchesPriceMax && matchesAvailable && matchesPublished && matchesCategory;
            });

            // ===== –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É =====
            const updateProduct = (id, updated) => {
                setProducts(products.map(p => p.id === id ? updated : p));
            };
            const addProduct = () => {
                setProducts([...products, { ...newProduct, id: Date.now() }]);
                setNewProduct({});
                setShowAddProductModal(false);
            };

            // ===== –û–±–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ =====
            useEffect(() => {
                const totalProfit = orders.reduce((sum, o) => sum + ((o.price || 0) - (o.cost || 0)), 0);
                setStats(prev => ({
                    ...prev,
                    totalProducts: products.length,
                    availableProducts: products.filter(p => p.available).length,
                    publishedProducts: products.filter(p => p.published).length,
                    totalOrders: orders.length,
                    newOrders: orders.filter(o => o.status === 'new').length,
                    completedOrders: orders.filter(o => o.status === 'completed').length,
                    totalProfit
                }));
            }, [products, orders]);

            return (
                <div className="pb-24">
                    {/* –ü–æ—à—É–∫ —Ç–∞ –§—ñ–ª—å—Ç—Ä–∏ */}
                    {activeTab === 'products' && (
                        <div className="p-3 bg-white mb-3 rounded shadow-sm">
                            <input type="text" placeholder="–ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—É..." value={searchQuery}
                                onChange={e => setSearchQuery(e.target.value)}
                                className="w-full px-3 py-2 border rounded mb-2" />
                            <div className="flex gap-2 flex-wrap text-xs">
                                <input type="number" placeholder="–¶—ñ–Ω–∞ min" value={filters.priceMin}
                                    onChange={e => setFilters({ ...filters, priceMin: e.target.value })}
                                    className="px-2 py-1 border rounded w-24" />
                                <input type="number" placeholder="–¶—ñ–Ω–∞ max" value={filters.priceMax}
                                    onChange={e => setFilters({ ...filters, priceMax: e.target.value })}
                                    className="px-2 py-1 border rounded w-24" />
                                <select value={filters.available === null ? '' : filters.available}
                                    onChange={e => setFilters({ ...filters, available: e.target.value === '' ? null : e.target.value === 'true' })}
                                    className="px-2 py-1 border rounded">
                                    <option value="">–í—Å—ñ</option>
                                    <option value="true">–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</option>
                                    <option value="false">–ù–µ–º–∞—î</option>
                                </select>
                                <select value={filters.published === null ? '' : filters.published}
                                    onChange={e => setFilters({ ...filters, published: e.target.value === '' ? null : e.target.value === 'true' })}
                                    className="px-2 py-1 border rounded">
                                    <option value="">–í—Å—ñ</option>
                                    <option value="true">–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ</option>
                                    <option value="false">–ù–µ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ</option>
                                </select>
                                <select multiple value={selectedCategories}
                                    onChange={e => setSelectedCategories([...e.target.selectedOptions].map(o => o.value))}
                                    className="px-2 py-1 border rounded">
                                    {categories.map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                                <button onClick={() => setShowAddProductModal(true)} className="bg-green-600 text-white px-3 py-1 rounded">
                                    ‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä
                                </button>
                            </div>
                        </div>
                    )}

                    {/* –¢–æ–≤–∞—Ä–∏ */}
                    {activeTab === 'products' && (
                        <div className="p-3 space-y-3">
                            {filteredProducts.map(product => (
                                <div key={product.id} className="bg-white rounded-lg p-4 shadow-sm flex justify-between items-center">
                                    <div>
                                        <h3 className="font-semibold">{product.name}</h3>
                                        <p className="text-xs">üí∞ {product.rrp}‚Ç¥</p>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={() => { setEditingProduct(product); setShowEditModal(true); }} className="bg-blue-600 text-white px-3 py-1 rounded">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                                        <button onClick={() => { setSelectedProduct(product); setShowPostModal(true); }} className="bg-purple-600 text-white px-3 py-1 rounded">–ü–æ—Å—Ç–∏</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è */}
                    {activeTab === 'orders' && (
                        <div className="p-3 space-y-3">
                            <button onClick={() => setShowOrderModal(true)} className="bg-green-600 text-white px-3 py-2 rounded mb-2">‚ûï –ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
                            {orders.map(order => (
                                <div key={order.id} className="bg-white rounded-lg p-4 shadow-sm">
                                    <div className="flex justify-between items-start mb-2">
                                        <div>
                                            <h3 className="font-semibold text-sm">{order.productName}</h3>
                                            <p className="text-xs">{order.customerName}</p>
                                            <p className="text-xs">{order.customerPhone}</p>
                                        </div>
                                        <select value={order.status} onChange={(e) => updateOrderStatus(order.id, e.target.value)}
                                            className={`px-2 py-1 rounded text-xs font-medium ${order.status === 'new' ? 'bg-blue-100 text-blue-800' :
                                                    order.status === 'sent' ? 'bg-yellow-100 text-yellow-800' :
                                                        order.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                                }`}>
                                            <option value="new">–ù–æ–≤–µ</option>
                                            <option value="sent">–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ</option>
                                            <option value="completed">–í–∏–∫–æ–Ω–∞–Ω–æ</option>
                                            <option value="cancelled">–°–∫–∞—Å–æ–≤–∞–Ω–æ</option>
                                        </select>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* –ù–∏–∂–Ω—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg z-40">
                        <div className="flex">
                            {[
                                { id: 'products', icon: PackageIcon, name: '–¢–æ–≤–∞—Ä–∏' },
                                { id: 'orders', icon: ShoppingBagIcon, name: '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è' },
                                { id: 'tasks', icon: CheckSquareIcon, name: '–ó–∞–≤–¥–∞–Ω–Ω—è' },
                                { id: 'stats', icon: BarChartIcon, name: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞' }
                            ].map(tab => (
                                <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                                    className={`flex-1 py-3 flex flex-col items-center gap-1 transition-colors relative ${activeTab === tab.id ? 'text-blue-600' : 'text-gray-600'
                                        }`}>
                                    <tab.icon size={24} />
                                    <span className="text-xs">{tab.name}</span>
                                    {tab.id === 'orders' && stats.newOrders > 0 && (
                                        <span className="absolute top-1 right-4 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                            {stats.newOrders}
                                        </span>
                                    )}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* –ú–æ–¥–∞–ª–∫–∏ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è */}
                    {showEditModal && editingProduct && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-end">
                            <div className="bg-white rounded-t-2xl w-full max-h-[90vh] overflow-y-auto p-4">
                                <h3 className="font-semibold mb-2">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</h3>
                                <input type="text" value={editingProduct.name}
                                    onChange={e => setEditingProduct({ ...editingProduct, name: e.target.value })}
                                    className="w-full px-3 py-2 border rounded mb-2" />
                                <input type="number" value={editingProduct.rrp}
                                    onChange={e => setEditingProduct({ ...editingProduct, rrp: parseFloat(e.target.value) })}
                                    className="w-full px-3 py-2 border rounded mb-2" />
                                <label className="flex items-center gap-2"><input type="checkbox" checked={editingProduct.available}
                                    onChange={e => setEditingProduct({ ...editingProduct, available: e.target.checked })} /> ‚úÖ –í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</label>
                                <label className="flex items-center gap-2"><input type="checkbox" checked={editingProduct.published}
                                    onChange={e => setEditingProduct({ ...editingProduct, published: e.target.checked })} /> üì± –û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ</label>
                                <div className="flex gap-2 mt-3">
                                    <button onClick={() => setShowEditModal(false)} className="flex-1 bg-gray-200 py-2 rounded">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                                    <button onClick={() => { updateProduct(editingProduct.id, editingProduct); setShowEditModal(false); }} className="flex-1 bg-blue-600 text-white py-2 rounded">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showAddProductModal && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-end">
                            <div className="bg-white rounded-t-2xl w-full max-h-[90vh] overflow-y-auto p-4">
                                <h3 className="font-semibold mb-2">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h3>
                                <input type="text" placeholder="–ù–∞–∑–≤–∞" value={newProduct.name || ''}
                                    onChange={e => setNewProduct({ ...newProduct, name: e.target.value })}
                                    className="w-full px-3 py-2 border rounded mb-2" />
                                <input type="number" placeholder="–¶—ñ–Ω–∞ (‚Ç¥)" value={newProduct.rrp || ''}
                                    onChange={e => setNewProduct({ ...newProduct, rrp: parseFloat(e.target.value) })}
                                    className="w-full px-3 py-2 border rounded mb-2" />
                                <input type="text" placeholder="–ö–æ–¥ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞" value={newProduct.supplierCode || ''}
                                    onChange={e => setNewProduct({ ...newProduct, supplierCode: e.target.value })}
                                    className="w-full px-3 py-2 border rounded mb-2" />
                                <input type="text" placeholder="–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫" value={newProduct.supplier || ''}
                                    onChange={e => setNewProduct({ ...newProduct, supplier: e.target.value })}
                                    className="w-full px-3 py-2 border rounded mb-2" />
                                <div className="flex gap-2 mt-2">
                                    <button onClick={() => setShowAddProductModal(false)} className="flex-1 bg-gray-200 py-2 rounded">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                                    <button onClick={addProduct} className="flex-1 bg-green-600 text-white py-2 rounded">–î–æ–¥–∞—Ç–∏</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
